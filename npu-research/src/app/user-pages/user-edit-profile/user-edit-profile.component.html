<div class="bg-gray-100 min-h-screen p-6">
  <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow p-8 space-y-10">
    <!-- Header -->
    <div>
      <h1 class="text-3xl text-gray-800">แก้ไขข้อมูลนักวิจัย</h1>
      <div class="flex items-center gap-2 mt-3 text-indigo-600">
        <i class="bi bi-pencil-square"></i>
        <span>ข้อมูลประวัติทั่วไป</span>
      </div>
      <hr class="mt-4" />
    </div>

    <!-- ================= Section 1 ================= -->
    <div class="grid grid-cols-12 gap-6">
      <!-- คำนำหน้า -->
      <div class="col-span-12 md:col-span-2 relative">
        <label class="block text-sm mb-1">คำนำหน้า</label>
        <button
          (click)="toggle('titles', $event)"
          class="w-full border rounded px-3 py-2 flex justify-between"
        >
          {{ selectedTitle || "เลือก" }}
          <i class="bi bi-chevron-down"></i>
        </button>

        <div
          *ngIf="isOpen('titles')"
          class="absolute z-50 w-full bg-white border rounded mt-1 shadow"
          (click)="$event.stopPropagation()"
        >
          <input
            [(ngModel)]="searchTitle"
            placeholder="ค้นหา..."
            class="w-full px-3 py-2 border-b"
          />
          <ul class="max-h-48 overflow-y-auto">
            <li
              *ngFor="let t of filteredTitles()"
              (click)="selectTitles(t)"
              class="px-4 py-2 hover:bg-indigo-50 cursor-pointer"
            >
              {{ t }}
            </li>
            <li
              *ngIf="filteredTitles().length === 0"
              class="px-4 py-2 text-gray-400"
            >
              ไม่พบข้อมูล
            </li>
          </ul>
        </div>
      </div>

      <div class="col-span-12 md:col-span-5">
        <label>ชื่อ</label>
        <input class="w-full border rounded px-3 py-2" />
      </div>

      <div class="col-span-12 md:col-span-5">
        <label>นามสกุล</label>
        <input class="w-full border rounded px-3 py-2" />
      </div>
    </div>

    <!-- ================= Section 2 ================= -->
    <div class="grid grid-cols-12 gap-6">
      <!-- คำนำหน้า -->
      <div class="col-span-12 md:col-span-4">
        <label>ชื่อภาษาอังกฤษ</label>
        <input class="w-full border rounded px-3 py-2" />
      </div>

      <div class="col-span-12 md:col-span-4">
        <label>นามสกุลภาษาอังกฤษ</label>
        <input class="w-full border rounded px-3 py-2" />
      </div>
      <div class="col-span-12 md:col-span-4">
        <label>วัน/เดือน/ปีเกิด</label>
        <input type="date" class="w-full border rounded px-3 py-2" />
      </div>
    </div>

    <!-- ================= Section 3 ================= -->
    <div class="grid grid-cols-12 gap-6">
      <!-- เชื้อชาติ -->
      <div class="col-span-12 md:col-span-3 relative">
        <label>เชื้อชาติ</label>
        <button
          (click)="toggle('ethnicity', $event)"
          class="w-full border rounded px-3 py-2 flex justify-between"
        >
          {{ selectedEthnicity || "เลือก" }}
          <i class="bi bi-chevron-down"></i>
        </button>

        <div
          *ngIf="isOpen('ethnicity')"
          class="absolute z-50 w-full bg-white border mt-1 shadow"
          (click)="$event.stopPropagation()"
        >
          <input
            [(ngModel)]="searchEthnicity"
            placeholder="ค้นหา..."
            class="w-full px-3 py-2 border-b"
          />
          <ul>
            <li
              *ngFor="let e of filteredEthnicity()"
              (click)="selectEthnicitys(e)"
              class="px-4 py-2 hover:bg-indigo-50 cursor-pointer"
            >
              {{ e }}
            </li>
            <li
              *ngIf="filteredEthnicity().length === 0"
              class="px-4 py-2 text-gray-400"
            >
              ไม่พบข้อมูล
            </li>
          </ul>
        </div>
      </div>

      <!-- สัญชาติ -->
      <div class="col-span-12 md:col-span-3 relative">
        <label class="block mb-1">สัญชาติ</label>

        <button
          type="button"
          (click)="toggle('nationality', $event)"
          class="w-full border rounded px-3 py-2 flex justify-between items-center"
        >
          {{ selectedNationality || "เลือก" }}
          <i class="bi bi-chevron-down"></i>
        </button>

        <!-- Dropdown -->
        <div
          *ngIf="isOpen('nationality')"
          class="absolute z-50 w-full bg-white border mt-1 shadow rounded"
          (click)="$event.stopPropagation()"
        >
          <input
            [(ngModel)]="searchNationality"
            placeholder="ค้นหา..."
            class="w-full px-3 py-2 border-b outline-none"
            (click)="$event.stopPropagation()"
          />

          <ul class="max-h-48 overflow-y-auto">
            <li
              *ngFor="let n of filteredNationality()"
              (click)="selectNationalitys(n)"
              class="px-4 py-2 hover:bg-indigo-50 cursor-pointer"
            >
              {{ n }}
            </li>

            <li
              *ngIf="filteredNationality().length === 0"
              class="px-4 py-2 text-gray-400"
            >
              ไม่พบข้อมูล
            </li>
          </ul>
        </div>
      </div>

      <!-- ศาสนา -->
      <div class="col-span-12 md:col-span-3 relative">
        <label>ศาสนา</label>
        <button
          (click)="toggle('religion', $event)"
          class="w-full border rounded px-3 py-2 flex justify-between"
        >
          {{ selectedReligion || "เลือก" }}
          <i class="bi bi-chevron-down"></i>
        </button>

        <div
          *ngIf="isOpen('religion')"
          class="absolute z-50 w-full bg-white border mt-1 shadow"
          (click)="$event.stopPropagation()"
        >
          <input
            [(ngModel)]="searchReligion"
            placeholder="ค้นหา..."
            class="w-full px-3 py-2 border-b"
          />
          <ul>
            <li
              *ngFor="let r of filteredReligion()"
              (click)="selectReligion(r)"
              class="px-4 py-2 hover:bg-indigo-50 cursor-pointer"
            >
              {{ r }}
            </li>
            <li
              *ngIf="filteredReligion().length === 0"
              class="px-4 py-2 text-gray-400"
            >
              ไม่พบข้อมูล
            </li>
          </ul>
        </div>
      </div>

      <!-- กรุ๊ปเลือด -->
      <div class="col-span-12 md:col-span-3">
        <label>กรุ๊ปเลือด</label>
        <select class="w-full border rounded px-3 py-2">
          <option *ngFor="let b of blood">{{ b }}</option>
        </select>
      </div>
    </div>

    <!-- ================== Section 5 ================= -->
    <div class="grid grid-cols-12 gap-6">
      <!-- คำนำหน้า -->
      <div class="col-span-12 md:col-span-4">
        <label>เบอร์โทรศัพท์มือถือ</label>
        <input class="w-full border rounded px-3 py-2" />
      </div>

      <div class="col-span-12 md:col-span-4">
        <label>อีเมล</label>
        <input class="w-full border rounded px-3 py-2" />
      </div>
      <div class="col-span-12 md:col-span-4">
        <label>ความสนใจ</label>
        <textarea class="w-full border rounded px-3 py-2"></textarea>
      </div>
    </div>

    <!-- ================= Section 5 ================= -->
    <div class="relative max-w-xl">
      <label>สาขาวิชาที่เชี่ยวชาญ</label>

      <div
        class="border rounded px-3 py-2 flex flex-wrap gap-2 cursor-pointer"
        (click)="toggle('majors', $event)"
      >
        <span
          *ngFor="let m of selectedMajors; let i = index"
          class="bg-indigo-500 text-white px-3 py-1 rounded"
        >
          {{ m }}
          <span
            class="ml-2 cursor-pointer"
            (click)="removeMajor(i); $event.stopPropagation()"
            >✕</span
          >
        </span>

        <span *ngIf="selectedMajors.length === 0" class="text-gray-400">
          คลิกเพื่อเลือก
        </span>
      </div>

      <div
        *ngIf="isOpen('majors')"
        class="absolute z-50 w-full bg-white border mt-2 shadow"
        (click)="$event.stopPropagation()"
      >
        <input
          [(ngModel)]="searchMajor"
          placeholder="ค้นหา..."
          class="w-full px-3 py-2 border-b"
        />
        <ul>
          <li
            *ngFor="let m of filteredMajors()"
            (click)="selectMajor(m)"
            class="px-4 py-2 hover:bg-indigo-50 cursor-pointer"
          >
            {{ m }}
          </li>
          <li
            *ngIf="filteredMajors().length === 0"
            class="px-4 py-2 text-gray-400"
          >
            ไม่พบข้อมูล
          </li>
        </ul>
      </div>
    </div>

    <!-- Save -->
    <div class="flex justify-center mt-6">
      <button
        (click)="save()"
        class="px-6 py-2 bg-yellow-300 rounded hover:bg-yellow-400"
      >
        บันทึกข้อมูล
      </button>
    </div>
  </div>
</div>
