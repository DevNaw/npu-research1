<div class="bg-gray-100 min-h-screen p-6">
  <!-- ===== SEARCH ===== -->
  <div class="max-w-7xl mx-auto bg-white rounded-xl p-6 shadow">
    <!-- Title -->
    <h1 class="text-2xl font-semibold mb-6 flex items-center gap-2">
      <i class="bi bi-funnel"></i>
      ระบุเงื่อนไขในการค้นหา
    </h1>

    <h2 class="text-center mb-4 text-2xl">ค้นหาข้อมูลนักวิจัย</h2>

    <!-- หน่วยงาน -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-start mb-6">
      <!-- Label -->
      <label class="md:text-right font-medium text-gray-700 pt-2">
        หน่วยงาน :
      </label>

      <!-- Dropdown -->
      <div class="md:col-span-3 relative">
        <!-- Button -->
        <button
          type="button"
          (click)="toggleDropdown('faculties', $event)"
          class="w-full border rounded-md px-3 py-2 flex justify-between items-center bg-white"
        >
          <span class="truncate">
            {{ selectedFaculty || "เลือกหน่วยงาน" }}
          </span>
          <i class="bi bi-chevron-down"></i>
        </button>

        <!-- Dropdown panel -->
        <div
          *ngIf="isOpen('faculties')"
          class="absolute z-50 w-full bg-white border rounded-md mt-1 shadow"
          (click)="$event.stopPropagation()"
        >
          <!-- Search -->
          <input
            [(ngModel)]="searchFaculitie"
            placeholder="ค้นหา..."
            class="w-full px-3 py-2 border-b outline-none"
          />

          <!-- List -->
          <ul class="max-h-48 overflow-y-auto">
            <li
              *ngFor="let f of filteredFaculties()"
              (click)="selectFaculities(f)"
              class="px-4 py-2 hover:bg-yellow-50 cursor-pointer"
            >
              {{ f }}
            </li>

            <li
              *ngIf="filteredFaculties().length === 0"
              class="px-4 py-2 text-gray-400 text-center"
            >
              ไม่พบข้อมูล
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- สายงาน -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center mb-6">
      <label class="md:text-right font-medium text-gray-700"> สายงาน : </label>

      <select
        [(ngModel)]="selectedCareer"
        class="md:col-span-3 w-full border rounded-md px-4 py-2 focus:ring focus:ring-yellow-200"
      >
        <option value="">ทั้งหมด</option>
        <option value="academic">สายวิชาการ</option>
        <option value="support">สายสนับสนุน</option>
      </select>
    </div>

    <!-- ชื่อนักวิจัย -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center mb-6">
      <label class="md:text-right font-medium text-gray-700">
        ชื่อนักวิจัย :
      </label>

      <input
        [(ngModel)]="researcherName"
        type="text"
        class="md:col-span-3 w-full border rounded-md px-4 py-2 focus:ring focus:ring-yellow-200"
        placeholder="กรอกชื่อนักวิจัย"
      />
    </div>

    <!-- Buttons -->
    <div class="flex justify-center gap-4 mt-8">
      <button
        (click)="search()"
        class="px-6 py-2 bg-[#FACC15] text-[#1E293B] rounded-lg hover:bg-[#FDE68A] transition"
      >
        <i class="bi bi-search mr-2"></i>
        ค้นหา
      </button>
    </div>
  </div>

  <!-- ===== DONUT CHART ===== -->
  <div
    *ngIf="isSearched"
    class="max-w-7xl mx-auto mt-8 grid grid-cols-1 md:grid-cols-2 gap-6"
  >
    <div class="bg-white rounded-xl shadow p-6">
      <h2 class="font-semibold mb-4">สัดส่วนนักวิจัย จำแนกตามสายงาน</h2>

      <apx-chart
        *ngIf="donutSeries.length > 0; else noData"
        [series]="donutSeries"
        [labels]="donutLabels"
        [chart]="donutChart"
        [legend]="donutLegend"
      ></apx-chart>

      <ng-template #noData>
        <div class="text-center text-gray-400 py-16">ไม่พบข้อมูล</div>
      </ng-template>
    </div>

    <div
      class="bg-white rounded-xl shadow p-6 flex flex-col justify-center items-center"
    >
      <p *ngFor="let l of donutLabels; let i = index">
        {{ l }} : {{ donutSeries[i] }} คน
      </p>

      <p class="mt-4 text-sm text-gray-500">
        รวมทั้งหมด {{ totalResearchers }} คน
      </p>
    </div>
  </div>

  <!-- ===== TABLE ===== -->
  <div
    *ngIf="isSearched"
    class="max-w-7xl mx-auto mt-8 bg-white rounded-xl shadow p-6"
  >
    <h2 class="text-xl font-semibold mb-4">รายชื่อนักวิจัย</h2>

    <div class="overflow-x-auto">
      <table class="w-full border border-gray-300">
        <thead class="bg-[#FACC15]">
          <tr>
            <th class="p-3 border">ลำดับ</th>
            <th class="p-3 border text-left">ชื่อ</th>
            <th class="p-3 border text-left">หน่วยงาน</th>
            <th class="p-3 border text-left">สายงาน</th>
            <th class="p-3 border text-left">ตำแหน่ง</th>
          </tr>
        </thead>

        <tbody>
          <tr
            *ngFor="let r of filteredResearchers; let i = index"
            class="hover:bg-gray-50"
          >
            <td class="p-3 border text-center">{{ i + 1 }}</td>
            <td class="p-3 border">{{ r.name }}</td>
            <td class="p-3 border">{{ r.faculty }}</td>
            <td class="p-3 border">
              {{ r.career_path === "academic" ? "สายวิชาการ" : "สายสนับสนุน" }}
            </td>
            <td class="p-3 border">{{ r.position }}</td>
          </tr>

          <tr *ngIf="filteredResearchers.length === 0">
            <td colspan="5" class="p-4 text-center text-gray-500">
              ไม่พบข้อมูล
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
